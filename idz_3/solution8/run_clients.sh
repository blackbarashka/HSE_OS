#!/bin/bash
# Проверка количества аргументов
if [ $# -lt 3 ]; then
    echo "Использование: $0 <количество_стай> <ip_адрес> <порт> [задержка между запусками=1]"
    echo "Пример: $0 5 127.0.0.1 8080 0.5"
    exit 1
fi

# Параметры запуска
NUM_BEES=$1          # Количество стай пчел
SERVER_IP=$2         # IP-адрес сервера
SERVER_PORT=$3       # Порт сервера
DELAY=${4:-1}        # Задержка между запусками (по умолчанию 1 секунда)

# Проверка наличия исполняемого файла клиента
if [ ! -f "./client" ]; then
    echo "ОШИБКА: Файл 'client' не найден в текущей директории."
    echo "Убедитесь, что вы находитесь в правильной директории и выполнили компиляцию (make)."
    exit 1
fi

# Вывод информации о запуске
echo "============================================================"
echo "  Запуск $NUM_BEES стай пчел"
echo "  Сервер: $SERVER_IP:$SERVER_PORT"
echo "============================================================"

# Запуск клиентов с выбранной задержкой
for ((i=1; i<=$NUM_BEES; i++)); do
    echo "[$(date +"%H:%M:%S")] Запуск стаи #$i..."
    ./client $i $SERVER_IP $SERVER_PORT &
    PID=$!
    echo "  ├── PID: $PID"
    
    # Вычисляем наличие следующего клиента
    if [ $i -lt $NUM_BEES ]; then
        echo "  └── Ожидание $DELAY сек. перед запуском следующей стаи..."
        sleep $DELAY
    fi
done

echo ""
echo "Все стаи запущены! Процесс работает в фоновом режиме."


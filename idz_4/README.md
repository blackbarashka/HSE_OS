# Индивидуальное домашнее задание 4. Мусаев Умахан Рашидович. Вариант 4.

## Условие
Задача о Винни-Пухе – 3 или мстительные пчелы. Неправильные пчелы, подсчитав в конце месяца убытки от наличия в
лесу Винни-Пуха, решили разыскать его и наказать в назидание
всем другим любителям сладкого. Для поисков медведя они поделили лес на участки, каждый из которых прочесывает одна стая
неправильных пчел. В случае нахождения медведя на своем участке стая проводит показательное наказание и возвращается в улей.
Если участок прочесан, а Винни-Пух на нем не обнаружен, стая также возвращается в улей. Там она получает информацию об еще
участках, которые еще не исследованы и снова улетает. Или прекращает поиски, узнав, что Винни-Пух наказан.
Создать клиент–серверное приложение, моделирующее поведение пчел.


## Основные возможности

### Моделирование поиска
- Разбиение леса на секторы с уникальными идентификаторами
- Случайное размещение Винни-Пуха в одном из секторов
- Симуляция поиска с временными задержками

### Сетевое взаимодействие
- Реализация протокола обмена данными через UDP
- Асинхронное взаимодействие компонентов системы
- Механизм контроля активности участников (heartbeat)

### Мониторинг и управление
- Визуализация хода поиска в реальном времени
- Динамическое управление клиентами во время работы
- Централизованное отображение статуса системы

## Оценка 4-5 баллов

### Описание реализации
В базовой версии программы реализована простая клиент-серверная архитектура, где:
1. **Сервер:**
   - Создает и инициализирует секторы леса
   - Случайно размещает Винни-Пуха в одном из секторов
   - Распределяет сектора между клиентами по их запросу
   - Принимает и обрабатывает отчеты о поиске

2. **Клиент (стая пчел):**
   - Запрашивает у сервера сектор для поиска
   - Симулирует процесс поиска с задержкой
   - Отправляет отчет о результатах поиска
   - Завершает работу при нахождении Винни-Пуха или окончании секторов

### Особенности
- Сервер и клиенты независимо отображают только полученную информацию
- Нет централизованного отображения общего процесса
- Взаимодействие через простые UDP-сообщения
- Минимальная обработка ошибок

### Компоненты программы
- `server.cpp` - сервер
- `client.cpp` - клиент (стая пчел)
### Реализованные методы сервера (server.cpp)

#### `int main(int argc, char* argv[])`
- Основной метод сервера, инициализирующий сокеты и обрабатывающий сообщения
- Случайное размещение Винни-Пуха в одном из секторов
- Создание и настройка UDP-сокета для обмена с клиентами
- Реализация главного цикла обработки сообщений

#### Обработка сообщений:
- `REQUEST` - выделение сектора для поиска клиенту
- `REPORT` - получение отчета от клиента о результатах поиска
- `FINISH` - обработка запроса на завершение от клиента

### Реализованные методы клиента (client.cpp)

#### `void signalHandler(int signum)`
- Обработчик сигналов для корректного завершения работы клиента

#### `void searchForWinnieInSector(int sectorId, int swarmId)`
- Симуляция процесса поиска Винни-Пуха в секторе
- Генерация случайного времени поиска
- Отображение прогресса и результата поиска

#### `int main(int argc, char* argv[])`
- Основной метод клиента, устанавливающий соединение с сервером
- Запрос секторов для поиска и отправка отчетов
- Обработка ответов от сервера

### Протокол обмена сообщениями
- `REQUEST:<swarm_id>` - Запрос сектора для поиска
- `SEARCH:<sector_id>` - Назначение сектора для поиска
- `REPORT:<swarm_id>:<sector_id>` - Отчет о поиске
- `WINNIE_FOUND` - Сообщение об обнаружении Винни-Пуха
- `CONTINUE` - Инструкция продолжить поиск
- `NO_MORE_SECTORS` - Нет доступных секторов
- `FINISH` - Запрос на завершение работы

## Оценка 6-7 баллов

### Описание реализации
В этой версии добавлен клиент-монитор, который предоставляет комплексную информацию о всей системе в целом:
1. **Клиент-монитор:**
   - Подключается к серверу на специальном порту мониторинга
   - Получает полную информацию о состоянии всех секторов
   - Отображает карту леса с информацией о проверенных секторах
   - Показывает текущее положение всех стай и их статус

2. **Сервер:**
   - Расширен для поддержки подключения монитора
   - Хранит и обновляет полное состояние системы
   - Отправляет агрегированные данные монитору

### Особенности
- Визуальное отображение состояния поиска
- Отдельный порт для работы монитора
- Улучшенное ведение журнала событий
- Единая визуализация всей системы

### Компоненты программы
- `server.cpp` - расширенный сервер
- `client.cpp` - клиент (стая пчел)
- `monitor.cpp` - новый клиент-монитор

### Что изменилось по сравнению с предыдущей версией
- Появился компонент визуализации (монитор)
- Сервер теперь хранит расширенную информацию о состоянии
- Добавлен отдельный порт для подключения монитора
- Улучшено форматирование вывода для удобства наблюдения
- 
### Дополнительные методы сервера (server.cpp)

#### `void updateMonitor()`
- Отправка актуального состояния системы монитору
- Формирование и отправка строки статуса для визуализации

#### `void handleMonitorMessages()`
- Обработка запросов от монитора
- Отправка информации о секторах и стаях

### Методы монитора (monitor.cpp)

#### `void displayForest(const std::vector<Sector>& sectors, const std::map<int, BeeSwarm>& beeSwarms)`
- Визуализация леса, секторов и положения стай
- Отображение статуса каждого сектора (проверен, найден Винни-Пух)

#### `void updateStatus()`
- Запрос обновления статуса у сервера
- Обработка полученной информации для отображения

#### `void displayStatistics(int searchedSectors, int totalSwarms, bool winnieFound)`
- Отображение статистики поиска (количество проверенных секторов, стай и т.д.)

#### Протокол обмена с монитором
- `STATUS` - Запрос текущего статуса
- `STATUS:<sectors_info>:<swarms_info>` - Ответ с информацией о системе
- `CONNECT_MONITOR` - Регистрация монитора
- `DISCONNECT_MONITOR` - Отключение монитора

## Оценка 8 баллов

### Описание реализации
В версии на 8 баллов добавлена возможность подключения нескольких мониторов одновременно без нарушения работы системы:
1. **Сервер:**
   - Поддерживает множественные подключения мониторов
   - Хранит список всех подключенных мониторов
   - Отправляет обновления всем мониторам при изменении состояния
   - Динамически добавляет и удаляет мониторы из списка рассылки

2. **Монитор:**
   - Реализует механизм регистрации на сервере
   - Может подключаться и отключаться во время работы системы
   - Поддерживает автоматическое восстановление соединения

### Особенности
- Поддержка нескольких мониторов одновременно
- Динамическое подключение и отключение мониторов
- Сохранение работоспособности при отказе отдельных мониторов
- Улучшенная устойчивость к сетевым проблемам

### Компоненты программы
- `bee_server_8.cpp` - сервер с поддержкой множества мониторов
- `bee_client_8.cpp` - клиент (стая пчел)
- `bee_monitor_8.cpp` - улучшенный клиент-монитор

### Что изменилось по сравнению с предыдущей версией
- Добавлен механизм регистрации и списка мониторов на сервере
- Реализована проверка активности мониторов
- Добавлена возможность динамического подключения мониторов
- Улучшена обработка сообщений для множества мониторов

### Улучшения сервера (bee_server_8.cpp)

#### `void broadcastToMonitors(const std::string& message)`
- Рассылка сообщений всем подключенным мониторам
- Эффективная передача обновлений без необходимости запросов от мониторов

#### `void addMonitor(const std::string& ip, int port)`
- Добавление нового монитора в список рассылки
- Отправка начального состояния новому монитору

#### `void removeMonitor(const std::string& ip, int port)`
- Удаление монитора из списка рассылки
- Очистка ресурсов, связанных с отключенным монитором

### Улучшения клиента-монитора (bee_monitor_8.cpp)

#### `void reconnect()`
- Автоматическое повторное подключение при потере соединения
- Восстановление состояния после переподключения

#### `void handleServerMessages()`
- Обработка входящих сообщений от сервера
- Обновление отображения при получении новой информации



## Оценка 10 баллов

### Описание реализации
Версия на 10 баллов добавляет возможность отключения и повторного подключения стай пчел без остановки сервера и корректного заверщения программ:
1. **Сервер:**
   - Отслеживает активность стай через механизм heartbeat
   - Обрабатывает отключение и переподключение клиентов
   - Сохраняет состояние поиска при отключении клиента
   - Учитывает отключенные сектора при распределении нагрузки

2. **Клиент (стая пчел):**
   - Реализует механизм периодической отправки heartbeat
   - Может корректно отключаться по команде
   - Обрабатывает переподключение к серверу
   - Восстанавливает свою работу после переподключения

3. **Контроллер:**
   - Новый компонент для управления стаями
   - Позволяет отключать и подключать стаи через командный интерфейс
   - Отображает статус всех известных стай пчел

### Особенности
- Устойчивость к отказам отдельных клиентов
- Механизм heartbeat для определения активности
- Возможность принудительного отключения стай
- Интерфейс управления стаями

### Компоненты программы
- `bee_server_10.cpp` - сервер с обработкой отключений
- `bee_client_10.cpp` - клиент с поддержкой heartbeat
- `bee_monitor_10.cpp` - монитор с отображением состояния стай
- `bee_manager.cpp` - новый компонент для управления стаями

### Что изменилось по сравнению с предыдущей версией
- Добавлен механизм уведомления о завершении сервера
- Реализована обработка сигналов операционной системы
- Добавлено подтверждение завершения от клиентов
- Повышена надежность при экстренном завершении
- Реализована логика корректного отключения и переподключения стай
- Добавлен компонент контроллера для управления стаями
- Улучшено управление состоянием секторов при отключениях
  
### Дополнительные методы сервера (bee_server_10.cpp)

#### `void signalHandler(int signum)`
- Обработчик сигналов для корректного завершения сервера
- Установка флага завершения для всех потоков

#### `void notifyClientsServerShutdown()`
- Отправка сообщения о завершении всем клиентам
- Ожидание завершения клиентов перед выходом

#### `void closeServer()`
- Корректное освобождение всех ресурсов
- Закрытие сокетов и завершение потоков

### Улучшения клиентов (bee_client_10.cpp)

#### `void handleServerShutdown()`
- Обработка сообщения о завершении работы сервера
- Корректное закрытие соединения и освобождение ресурсов

#### `void cleanupResources()`
- Очистка используемых ресурсов перед завершением
- Закрытие сокетов и завершение потоков

### Протокол завершения
- `SERVER_SHUTDOWN` - Сообщение о завершении работы сервера
- `CLIENT_SHUTDOWN_ACK` - Подтверждение получения сигнала завершения


# Запуск программ
## Задание на 4-5:
1. Пишем `make` или `g++ -o server.cpp` и `g++ -o client client.cpp`
2. В разных терминалах запускаем наши программы: `./server 127.0.0.1 8080` и `./client 127.0.0.1 8080`
3. Для запуска сразу нескольких стай: `chmod +x run_bees.sh`, затем `./run_bees <количество стай (по умолчанию 5)>`
## Пример работы программы:

![4_5](https://github.com/user-attachments/assets/6b4ed495-a910-445e-8910-2bc65d9e2cf4)

![run 4_5](https://github.com/user-attachments/assets/d7e836e7-eead-4601-845a-bb388fa41956)

---

## Задание на 6-7:
1. Пишем `make` или `g++ -o server.cpp`, `g++ -o client client.cpp` и `g++ -o monitor monitor.cpp`
2. В разных терминалах запускаем наши программы: `./server 127.0.0.1 8080`, `./client 127.0.0.1 8080` и `./monitor 127.0.0.1 9080` (ВНИМАНИЕ 9080, НЕ 8080)
3. Для запуска сразу нескольких стай: `chmod +x run_bees.sh`, затем `./run_bees <количество стай (по умолчанию 5)>`
## Пример работы программы:

![6_7](https://github.com/user-attachments/assets/c76ac2f3-747c-4bfd-af34-7e5feb7eb4f4)

---

## Задание на 8:
1. Пишем `make` или `g++ -o bee_server_8.cpp`, `g++ -o bee_client_8 bee_client_8.cpp` и `g++ -o bee_monitor_8 bee_monitor_8.cpp`
2. В разных терминалах запускаем наши программы: `./bee_server_8 127.0.0.1 8080`, `./bee_client_8 127.0.0.1 8080` и `./bee_monitor_8 127.0.0.1 9080` (ВНИМАНИЕ 9080, НЕ 8080), `bee_monitor_8` можно запусить сразу в несколькмх терминалах
3. Для запуска сразу нескольких стай: `chmod +x run_bees.sh`, затем `./run_bees <количество стай (по умолчанию 5)>`
## Пример работы программы:

![8](https://github.com/user-attachments/assets/76995e56-0ccf-45a6-95cf-a8d121e026ad)

![8 and](https://github.com/user-attachments/assets/4c5d0497-1c79-462b-9f6f-c9af8945e839)

---

## Задание на 10:
1. Пишем `make` или `g++ -o bee_server_8.cpp`, `g++ -o bee_client_8 bee_client_8.cpp`, `g++ -o bee_monitor_8 bee_monitor_8.cpp` и `g++ -o bee_manager bee_manager.cpp`
2. В разных терминалах запускаем наши программы: `./bee_server_8 127.0.0.1 8080` и `./bee_manager 127.0.0.1 10080` (ВНИМАНИЕ 10080, а не 8080)
Меню контроллера:

![10](https://github.com/user-attachments/assets/0481e3f8-72d8-4ee2-95e7-98612c76db75)

Тут мы уже можем запускать сразу несколько или одну стаю.
Также был улучшен наблюдатель, теперь уже прям картинкой нам показывают какой сектор уже проверен, какой проверяется, где найдет Винни-Пух.
## Пример работы программы:

![10 and](https://github.com/user-attachments/assets/95129fcd-3756-4126-a498-37da6c2b64ce)


